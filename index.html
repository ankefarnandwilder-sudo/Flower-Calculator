<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Preisrechner (offline)</title>
  <style>
    :root{
      --bg:#ffffff;
      --card:#ffffff;
      --line:#e8e8e8;
      --text:#1f1f1f;
      --muted:#6f6f6f;

      /* Deine zwei Akzentfarben (kein Rot) */
      --green:#2f6b57;   /* Gr√ºn */
      --brown:#7a5a3a;   /* Braun */

      --shadow: 0 8px 24px rgba(0,0,0,.08);
      --radius: 16px;
      --radius2: 12px;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      background: #f7f7f7;
      padding: 18px;
    }

    .wrap{
      max-width: 1050px;
      margin: 0 auto;
    }

    .card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 18px;
    }

    h1{
      margin: 0 0 8px 0;
      font-size: 28px;
      letter-spacing: .2px;
    }
    .sub{
      margin:0 0 14px 0;
      color:var(--muted);
      font-size: 13px;
    }

    .bar{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:center;
      margin: 10px 0 14px 0;
    }

    .btn{
      border:0;
      border-radius: 999px;
      padding: 10px 14px;
      font-weight: 700;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:8px;
      user-select:none;
      white-space:nowrap;
    }
    .btn:active{ transform: translateY(1px); }

    .btn-green{ background: var(--green); color:#fff; }
    .btn-brown{ background: var(--brown); color:#fff; }
    .btn-ghost{
      background:#efefef;
      color:#222;
      font-weight: 700;
    }

    /* Scrollbereich, damit es auf Handy nicht endlos wird */
    .table-wrap{
      border:1px solid var(--line);
      border-radius: var(--radius2);
      overflow:hidden;
    }
    .table-scroll{
      max-height: 420px; /* auf Desktop angenehm */
      overflow:auto;
      background:#fff;
    }
    @media (max-width: 700px){
      .table-scroll{ max-height: 58vh; } /* auf Handy gut */
      h1{ font-size: 22px; }
    }

    table{
      width:100%;
      border-collapse: collapse;
      min-width: 720px; /* damit Spalten nicht zu eng werden */
    }
    thead th{
      position: sticky;
      top: 0;
      background: #f4f4f4;
      z-index: 2;
      text-align:left;
      font-size: 13px;
      color:#333;
      padding: 12px 10px;
      border-bottom: 1px solid var(--line);
    }
    tbody td{
      padding: 10px;
      border-bottom: 1px solid var(--line);
      vertical-align: middle;
    }
    tbody tr:last-child td{ border-bottom:0; }

    .inp{
      width:100%;
      padding: 10px 10px;
      border:1px solid #dcdcdc;
      border-radius: 10px;
      font-size: 14px;
      outline:none;
      background:#fff;
    }
    .inp:focus{
      border-color:#bdbdbd;
      box-shadow: 0 0 0 3px rgba(0,0,0,.05);
    }

    .qty{
      width: 110px;
    }
    .price{
      width: 140px;
    }

    .sumBox{
      width: 160px;
      padding: 10px 10px;
      border:1px solid #dcdcdc;
      border-radius: 10px;
      background:#fafafa;
      font-variant-numeric: tabular-nums;
      text-align: right;
    }

    .footer{
      display:flex;
      flex-wrap:wrap;
      gap:12px;
      justify-content:space-between;
      align-items:center;
      margin-top: 12px;
    }
    .total{
      font-weight: 900;
      font-size: 16px;
      display:flex;
      gap:10px;
      align-items:center;
    }
    .total .val{
      font-variant-numeric: tabular-nums;
      background:#f4f4f4;
      border:1px solid var(--line);
      border-radius: 10px;
      padding: 8px 10px;
      min-width: 140px;
      text-align:right;
    }

    .hint{
      color:var(--muted);
      font-size: 12px;
    }

    /* Kleine Icon-Optik */
    .ico{
      font-size: 16px;
      line-height: 1;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Preisrechner <span style="font-weight:700; color:var(--muted);">(offline)</span></h1>
      <p class="sub">Alles bleibt lokal auf diesem Ger√§t. Speichern/Laden funktioniert √ºber den Browser.</p>

      <div class="bar">
        <button class="btn btn-green" id="addRowBtn"><span class="ico">Ôºã</span>Artikel hinzuf√ºgen</button>
        <button class="btn btn-brown" id="saveBtn"><span class="ico">üíæ</span>Speichern</button>
        <button class="btn btn-ghost" id="loadBtn"><span class="ico">‚Ü©</span>Laden</button>
        <button class="btn btn-ghost" id="resetQtyBtn"><span class="ico">‚ü≤</span>Mengen zur√ºcksetzen</button>
      </div>

      <div class="table-wrap">
        <div class="table-scroll">
          <table aria-label="Preisrechner Tabelle">
            <thead>
              <tr>
                <th style="width: 45%;">Artikel / Produkt / Leistung</th>
                <th style="width: 18%;">Einzelpreis (‚Ç¨)</th>
                <th style="width: 17%;">Menge</th>
                <th style="width: 20%; text-align:right;">Summe (‚Ç¨)</th>
              </tr>
            </thead>
            <tbody id="tbody"></tbody>
          </table>
        </div>
      </div>

      <div class="footer">
        <div class="total">
          <span>Gesamtsumme</span>
          <span class="val" id="grandTotal">0,00 ‚Ç¨</span>
        </div>
        <div class="hint">Tipp: Einzelpreis kann mit Komma eingegeben werden (z. B. 4,50).</div>
      </div>
    </div>
  </div>

  <script>
    // ====== Einstellungen ======
    const START_ROWS = 6;              // nicht zu viele offene Zeilen (Handy!)
    const STORAGE_KEY = "preisrechner_v1";

    // ====== Helfer: Zahl robust aus deutschem Input ======
    function parseEuroInput(value){
      // Erlaubt: "4,50" "4.50" "4" " 4,5 "
      if (value === null || value === undefined) return 0;
      let s = String(value).trim();
      if (!s) return 0;

      // Entferne Leerzeichen
      s = s.replace(/\s+/g, "");

      // Wenn jemand Tausenderpunkte nutzt (1.234,56), machen wir es robust:
      // - Entferne alle Punkte, die als Tausendertrenner wirken k√∂nnten,
      // - Dann Komma zu Punkt.
      // Heuristik: Wenn Komma existiert, entferne Punkte komplett.
      if (s.includes(",")) s = s.replace(/\./g, "");

      s = s.replace(",", ".");
      const n = Number(s);
      return Number.isFinite(n) ? n : 0;
    }

    function formatEuro(n){
      const x = Number.isFinite(n) ? n : 0;
      return x.toLocaleString("de-DE", { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + " ‚Ç¨";
    }

    // ====== Datenmodell ======
    function newRow(){
      return { name:"", price:"", qty:0 };
    }

    let rows = [];

    // ====== DOM ======
    const tbody = document.getElementById("tbody");
    const grandTotalEl = document.getElementById("grandTotal");

    function render(){
      tbody.innerHTML = "";

      rows.forEach((r, idx) => {
        const tr = document.createElement("tr");

        // Artikel
        const tdName = document.createElement("td");
        const inpName = document.createElement("input");
        inpName.className = "inp";
        inpName.value = r.name;
        inpName.placeholder = "";
        inpName.addEventListener("input", () => {
          rows[idx].name = inpName.value;
          // kein render n√∂tig
        });
        tdName.appendChild(inpName);

        // Preis
        const tdPrice = document.createElement("td");
        const inpPrice = document.createElement("input");
        inpPrice.className = "inp price";
        inpPrice.inputMode = "decimal";
        inpPrice.value = r.price;
        inpPrice.placeholder = "";
        inpPrice.addEventListener("input", () => {
          rows[idx].price = inpPrice.value;
          updateRowSum(idx);
          updateGrandTotal();
        });
        tdPrice.appendChild(inpPrice);

        // Menge
        const tdQty = document.createElement("td");
        const inpQty = document.createElement("input");
        inpQty.className = "inp qty";
        inpQty.type = "number";
        inpQty.min = "0";
        inpQty.step = "1";
        inpQty.value = r.qty ?? 0;
        inpQty.addEventListener("input", () => {
          const v = Number(inpQty.value);
          rows[idx].qty = Number.isFinite(v) ? v : 0;
          updateRowSum(idx);
          updateGrandTotal();
        });
        tdQty.appendChild(inpQty);

        // Summe
        const tdSum = document.createElement("td");
        tdSum.style.textAlign = "right";
        const sumBox = document.createElement("div");
        sumBox.className = "sumBox";
        sumBox.id = `sum_${idx}`;
        sumBox.textContent = formatEuro(calcRowSum(rows[idx]));
        tdSum.appendChild(sumBox);

        tr.appendChild(tdName);
        tr.appendChild(tdPrice);
        tr.appendChild(tdQty);
        tr.appendChild(tdSum);

        tbody.appendChild(tr);
      });

      updateGrandTotal();
    }

    function calcRowSum(row){
      const p = parseEuroInput(row.price);
      const q = Number(row.qty) || 0;
      return p * q;
    }

    function updateRowSum(idx){
      const el = document.getElementById(`sum_${idx}`);
      if (!el) return;
      el.textContent = formatEuro(calcRowSum(rows[idx]));
    }

    function updateGrandTotal(){
      const total = rows.reduce((acc, r) => acc + calcRowSum(r), 0);
      grandTotalEl.textContent = formatEuro(total);
    }

    // ====== Buttons ======
    document.getElementById("addRowBtn").addEventListener("click", () => {
      rows.push(newRow());
      render();
      // Nach unten scrollen (komfortabel)
      const sc = document.querySelector(".table-scroll");
      sc.scrollTop = sc.scrollHeight;
    });

    document.getElementById("resetQtyBtn").addEventListener("click", () => {
      // Mengen zur√ºcksetzen: Menge=0, Summen aktualisieren (Preis/Artikel bleibt)
      rows = rows.map(r => ({ ...r, qty: 0 }));
      render();
    });

    document.getElementById("saveBtn").addEventListener("click", () => {
      try{
        localStorage.setItem(STORAGE_KEY, JSON.stringify(rows));
        alert("Gespeichert.");
      }catch(e){
        alert("Speichern hat nicht geklappt (Browser blockiert ggf. Speicher).");
      }
    });

    document.getElementById("loadBtn").addEventListener("click", () => {
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if(!raw){
          alert("Noch kein gespeicherter Stand gefunden.");
          return;
        }
        const parsed = JSON.parse(raw);
        if(!Array.isArray(parsed)) throw new Error("Invalid");
        // Sanitize
        rows = parsed.map(x => ({
          name: String(x?.name ?? ""),
          price: String(x?.price ?? ""),
          qty: Number(x?.qty ?? 0) || 0
        }));
        if(rows.length === 0){
          rows = Array.from({length: START_ROWS}, () => newRow());
        }
        render();
        alert("Geladen.");
      }catch(e){
        alert("Laden hat nicht geklappt (gespeicherte Daten besch√§digt).");
      }
    });

    // ====== Init ======
    rows = Array.from({length: START_ROWS}, () => newRow());
    render();
  </script>
</body>
</html>

    
   
    
   
 

 
  
   
       

  

   




  


 

   
      
       
       
    
       
       
       
     

 
     
    
    
