<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Preisrechner offline</title>
  <style>
    :root{
      --bg:#fff;
      --text:#2b2b2b;
      --muted:#6b6b6b;
      --line:#e7e7e7;
      --card:#fbfbfb;

      --sage:#5f7f73;   /* Salbei */
      --sand:#b08a62;   /* Sand */
      --btnText:#fff;

      --radius:14px;
      --shadow:0 8px 20px rgba(0,0,0,.06);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:var(--bg);
      color:var(--text);
    }
    .wrap{
      max-width:980px;
      margin:18px auto 28px;
      padding:0 14px;
    }
    h1{
      margin:0 0 8px;
      text-align:center;
      font-size:1.45rem;
      letter-spacing:.2px;
    }
    .sub{
      margin:0 auto 12px;
      max-width:820px;
      color:var(--muted);
      font-size:.95rem;
      line-height:1.35;
      text-align:center;
    }
    .panel{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:12px;
    }

    .bar{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      justify-content:center;
      align-items:center;
      margin:6px 0 10px;
    }

    button{
      border:none;
      border-radius:12px;
      padding:10px 14px;
      font-weight:800;
      cursor:pointer;
      min-height:44px;
      color:var(--btnText);
      letter-spacing:.2px;
      transition:opacity .15s ease, transform .04s ease;
      user-select:none;
    }
    button:active{ transform:translateY(1px); }
    button:hover{ opacity:.92; }

    .btn-sage{ background:var(--sage); }
    .btn-sand{ background:var(--sand); }

    /* Grau statt Rot */
    .btn-ghost{
      background:#f2f2f2;
      color:var(--text);
      border:1px solid #dadada;
      font-weight:800;
    }
    .btn-ghost:hover{ opacity:1; background:#ededed; }

    .tableWrap{
      border:1px solid var(--line);
      border-radius:12px;
      overflow:auto;
      background:#fff;
      /* genug sichtbar + scroll, auch am Handy */
      max-height:70vh;
    }

    table{
      width:100%;
      border-collapse:collapse;
      background:#fff;
      min-width:700px; /* damit Spalten am Desktop stabil bleiben */
    }
    thead th{
      background:#f3f3f3;
      font-size:.92rem;
      text-align:left;
      padding:10px 10px;
      border-bottom:1px solid var(--line);
      position:sticky;
      top:0;
      z-index:1;
      white-space:nowrap;
    }
    tbody td{
      padding:8px 10px;
      border-bottom:1px solid var(--line);
      vertical-align:middle;
    }
    tbody tr:last-child td{ border-bottom:none; }

    .col-article{ width:48%; }
    .col-price{ width:18%; }
    .col-qty{ width:14%; }
    .col-sum{ width:16%; }
    .col-actions{ width:4%; }

    input[type="text"], input[type="number"]{
      width:100%;
      min-height:42px;
      padding:8px 10px;
      border:1px solid #d7d7d7;
      border-radius:12px;
      font-size:16px;
      outline:none;
      background:#fff;
    }
    input[type="number"]{
      text-align:right;
      -moz-appearance: textfield;
    }
    input[type="number"]::-webkit-outer-spin-button,
    input[type="number"]::-webkit-inner-spin-button{
      -webkit-appearance:none;
      margin:0;
    }

    input:focus{
      border-color:#8aa9ff;
      box-shadow:0 0 0 3px rgba(138,169,255,.22);
    }

    .sumCell{
      text-align:right;
      font-weight:900;
      white-space:nowrap;
    }
    .mutedCell{
      color:var(--muted);
      font-weight:800;
    }

    .rowActions{
      display:flex;
      gap:8px;
      justify-content:flex-end;
      align-items:center;
    }
    .mini{
      min-height:40px;
      padding:8px 10px;
      border-radius:12px;
      font-weight:900;
      line-height:1;
      width:42px;
      display:inline-flex;
      justify-content:center;
      align-items:center;
    }

    .total{
      margin-top:12px;
      border:1px solid var(--line);
      border-radius:14px;
      padding:12px;
      background:#fff;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
    }
    .total .label{ font-weight:900; font-size:1.05rem; }
    .total .value{ font-weight:950; font-size:1.25rem; white-space:nowrap; }

    .foot{
      margin-top:10px;
      color:var(--muted);
      font-size:.9rem;
      text-align:center;
      line-height:1.35;
    }

    @media (max-width:720px){
      .wrap{ padding:0 10px; }
      h1{ font-size:1.3rem; }
      .sub{ font-size:.92rem; }
      /* am Handy darf gescrollt werden */
      table{ min-width:640px; }
      .tableWrap{ max-height:72vh; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Preisrechner offline</h1>
    <p class="sub">
      Artikel/Produkt/Leistung, Einzelpreis und Menge eingeben – Summen werden automatisch berechnet.
      Speicherung lokal im Browser (keine Cloud).
    </p>

    <div class="panel">
      <div class="bar">
        <button class="btn-sage" id="btnAddRow">+ Zeile hinzufügen</button>
        <button class="btn-sand" id="btnSave">Speichern</button>
        <button class="btn-ghost" id="btnRestore">Wiederherstellen</button>
        <button class="btn-ghost" id="btnResetQty">Mengen zurücksetzen</button>
      </div>

      <div class="tableWrap" aria-label="Preisrechner Tabelle">
        <table>
          <thead>
            <tr>
              <th class="col-article">Artikel / Produkt / Leistung</th>
              <th class="col-price">Einzelpreis (€)</th>
              <th class="col-qty">Menge</th>
              <th class="col-sum">Summe</th>
              <th class="col-actions"></th>
            </tr>
          </thead>
          <tbody id="rows"></tbody>
        </table>
      </div>

      <div class="total">
        <div class="label">Gesamtsumme</div>
        <div class="value" id="grandTotal">0,00&nbsp;€</div>
      </div>

      <div class="foot">
        Offline, werbefrei, ohne Registrierung.
      </div>
    </div>
  </div>

  <script>
    const KEY = "price_calc_offline_v2";
    const DEFAULT_ROWS = 15; // sichtbar + trotzdem scroll

    function formatNumberDE(n){
      return n.toLocaleString("de-DE", { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    }
    function formatEUR(n){
      return formatNumberDE(n) + "\u00A0€";
    }

    // akzeptiert: "4,50" "4.50" "1.234,56" "1234,56"
    function parsePrice(str){
      if (!str) return 0;
      let s = String(str).trim().replace(/\s+/g, "");
      if (s === "") return 0;

      // Wenn Komma vorhanden: Punkt als Tausender entfernen, Komma -> Punkt
      if (s.includes(",")){
        s = s.replace(/\./g, "");
        s = s.replace(",", ".");
      }

      // Nur Ziffern und Punkt zulassen
      s = s.replace(/[^0-9.]/g, "");

      // Sicherheit: mehrere Punkte -> nur den ersten als Dezimalpunkt behalten
      const parts = s.split(".");
      if (parts.length > 2){
        s = parts[0] + "." + parts.slice(1).join("");
      }

      const n = Number(s);
      return Number.isFinite(n) ? n : 0;
    }

    function parseQty(str){
      const s = String(str ?? "").trim();
      if (s === "") return 0;
      const n = parseInt(s, 10);
      return Number.isFinite(n) && n > 0 ? n : 0;
    }

    function uid(){
      return String(Date.now()) + "_" + Math.random().toString(16).slice(2);
    }

    let state = { rows: [] };

    function makeRow(){
      return { id: uid(), article: "", priceStr: "", qtyStr: "" };
    }

    const tbody = document.getElementById("rows");
    const totalEl = document.getElementById("grandTotal");

    function autosave(){
      localStorage.setItem(KEY, JSON.stringify({ rows: state.rows, savedAt: Date.now() }));
    }

    function loadFromStorage(){
      try{
        const raw = localStorage.getItem(KEY);
        if (!raw) return false;
        const obj = JSON.parse(raw);
        if (!obj || !Array.isArray(obj.rows)) return false;
        state.rows = obj.rows;
        return true;
      } catch { return false; }
    }

    function updateTotals(){
      let grand = 0;

      for (const r of state.rows){
        const price = parsePrice(r.priceStr);
        const qty = parseQty(r.qtyStr);
        const sum = price * qty;

        const cell = document.getElementById("sum_" + r.id);
        if (cell){
          if (sum === 0){
            cell.textContent = "—";
            cell.classList.add("mutedCell");
          } else {
            cell.textContent = formatEUR(sum);
            cell.classList.remove("mutedCell");
          }
        }
        grand += sum;
      }

      totalEl.textContent = formatEUR(grand);
    }

    function insertRowAt(index){
      state.rows.splice(index, 0, makeRow());
      render(); updateTotals(); autosave();
    }

    function render(){
      tbody.innerHTML = "";

      state.rows.forEach((r, idx) => {
        const tr = document.createElement("tr");

        // Artikel
        const tdA = document.createElement("td");
        const inA = document.createElement("input");
        inA.type = "text";
        inA.placeholder = "z. B. Rose rot / Dienstleistung / Artikel …";
        inA.value = r.article;
        inA.addEventListener("input", () => { r.article = inA.value; autosave(); });
        tdA.appendChild(inA);

        // Preis
        const tdP = document.createElement("td");
        const inP = document.createElement("input");
        inP.type = "text";
        inP.inputMode = "decimal";
        inP.placeholder = "0,00";
        inP.value = r.priceStr;

        inP.addEventListener("input", () => {
          r.priceStr = inP.value;
          updateTotals();
          autosave();
        });

        // Optional: beim Verlassen sauber formatieren (ohne €)
        inP.addEventListener("blur", () => {
          const raw = String(inP.value).trim();
          if (raw === "") { r.priceStr = ""; inP.value = ""; updateTotals(); autosave(); return; }
          const n = parsePrice(raw);
          // nur formatieren, wenn sinnvoll
          if (n !== 0 || raw === "0" || raw === "0,0" || raw === "0,00"){
            const formatted = formatNumberDE(n); // "4,50"
            r.priceStr = formatted;
            inP.value = formatted;
            updateTotals();
            autosave();
          }
        });

        tdP.appendChild(inP);

        // Menge
        const tdQ = document.createElement("td");
        const inQ = document.createElement("input");
        inQ.type = "number";
        inQ.min = "0";
        inQ.step = "1";
        inQ.placeholder = "0";
        inQ.value = r.qtyStr;

        inQ.addEventListener("input", () => {
          r.qtyStr = inQ.value;
          updateTotals();
          autosave();
        });
        tdQ.appendChild(inQ);

        // Summe
        const tdS = document.createElement("td");
        tdS.className = "sumCell mutedCell";
        tdS.id = "sum_" + r.id;
        tdS.textContent = "—";

        // Actions
        const tdX = document.createElement("td");
        tdX.className = "col-actions";
        const actions = document.createElement("div");
        actions.className = "rowActions";

        // Zeile einfügen (unterhalb)
        const btnIns = document.createElement("button");
        btnIns.className = "mini btn-ghost";
        btnIns.type = "button";
        btnIns.title = "Zeile einfügen";
        btnIns.textContent = "+";
        btnIns.addEventListener("click", () => insertRowAt(idx + 1));

        // Duplizieren
        const btnDup = document.createElement("button");
        btnDup.className = "mini btn-ghost";
        btnDup.type = "button";
        btnDup.title = "Zeile duplizieren";
        btnDup.textContent = "⎘";
        btnDup.addEventListener("click", () => {
          const copy = { id: uid(), article: r.article, priceStr: r.priceStr, qtyStr: r.qtyStr };
          state.rows.splice(idx + 1, 0, copy);
          render(); updateTotals(); autosave();
        });

        // Löschen
        const btnDel = document.createElement("button");
        btnDel.className = "mini btn-ghost";
        btnDel.type = "button";
        btnDel.title = "Zeile löschen";
        btnDel.textContent = "✕";
        btnDel.addEventListener("click", () => {
          state.rows = state.rows.filter(x => x.id !== r.id);
          if (state.rows.length === 0) state.rows.push(makeRow());
          render(); updateTotals(); autosave();
        });

        actions.appendChild(btnIns);
        actions.appendChild(btnDup);
        actions.appendChild(btnDel);
        tdX.appendChild(actions);

        tr.appendChild(tdA);
        tr.appendChild(tdP);
        tr.appendChild(tdQ);
        tr.appendChild(tdS);
        tr.appendChild(tdX);

        tbody.appendChild(tr);
      });

      updateTotals();
    }

    // Buttons oben
    document.getElementById("btnAddRow").addEventListener("click", () => {
      state.rows.push(makeRow());
      render();
      autosave();
    });

    document.getElementById("btnSave").addEventListener("click", () => {
      autosave();
      // keine nervige Alert-Box – Speichern passiert still
      // optional: kleiner visueller Hinweis wäre möglich, lassen wir jetzt bewusst weg (stabil/final)
    });

    document.getElementById("btnRestore").addEventListener("click", () => {
      const ok = loadFromStorage();
      if (ok){
        if (state.rows.length === 0) state.rows.push(makeRow());
        render();
      }
    });

    document.getElementById("btnResetQty").addEventListener("click", () => {
      // keine Confirm-Box: in der Praxis stört das oft
      for (const r of state.rows) r.qtyStr = "";
      render();
      autosave();
    });

    // Init
    const ok = loadFromStorage();
    if (!ok || !Array.isArray(state.rows) || state.rows.length === 0){
      state.rows = [];
      for (let i=0; i<DEFAULT_ROWS; i++) state.rows.push(makeRow());
    }
    render();
  </script>
</body>
</html>





   


  
  

 

   

   

   
    
    
  
 
 



   
    


  





      

      

    
   
    
   
 

 
  
   
       

  

   




  


 

   
      
       
       
    
       
       
       
     

 
     
    
    
